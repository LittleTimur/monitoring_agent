# Monitoring Server (FastAPI)

–°–µ—Ä–≤–µ—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞–º–∏ –∏ —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
cd server
pip install -r requirements.txt
python run.py
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000

## API Endpoints

### –ê–≥–µ–Ω—Ç—ã

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤
- `POST /api/agents/register` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π ID
- `POST /api/agents/{agent_id}/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º ID

**–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö (JSON):**
```json
{
    "machine_name": "MyMachine",
    "machine_type": "Desktop",
    "ip_address": "192.168.1.100",
    "version": "1.0.0"
}
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏
- `GET /api/agents/` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤
- `GET /api/agents/statistics` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–≥–µ–Ω—Ç–∞–º
- `GET /api/agents/{agent_id}` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≥–µ–Ω—Ç–µ
- `GET /api/agents/{agent_id}/config` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞
- `POST /api/agents/{agent_id}/config` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### –°–∏—Å—Ç–µ–º–∞ –∫–æ–º–∞–Ω–¥ (NEW! üöÄ)

**–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥:**
- `POST /api/agents/{agent_id}/command` - –ö–æ–º–∞–Ω–¥–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∞–≥–µ–Ω—Ç—É
- `POST /api/agents/command_all` - –ö–æ–º–∞–Ω–¥–∞ –≤—Å–µ–º –∞–≥–µ–Ω—Ç–∞–º

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- `GET /api/agents/{agent_id}/command-executions` - –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–∞–Ω–¥ –∞–≥–µ–Ω—Ç–∞
- `GET /api/agents/{agent_id}/command-executions/{index}` - –°—Ç–∞—Ç—É—Å –∫–æ–º–∞–Ω–¥—ã
- `GET /api/agents/command-executions/status` - –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–∞–º–∏:**
- `POST /api/agents/{agent_id}/command-executions/{index}/retry` - –ü–æ–≤—Ç–æ—Ä –∫–æ–º–∞–Ω–¥—ã
- `DELETE /api/agents/{agent_id}/command-executions/{index}` - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏

#### –ú–µ—Ç—Ä–∏–∫–∏
- `POST /api/agents/{agent_id}/request_metrics` - –ó–∞–ø—Ä–æ—Å –º–µ—Ç—Ä–∏–∫ –æ—Ç –∞–≥–µ–Ω—Ç–∞
- `POST /api/agents/request_metrics_from_all` - –ó–∞–ø—Ä–æ—Å –º–µ—Ç—Ä–∏–∫ –æ—Ç –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤
- `POST /metrics` - –ü—Ä–∏–µ–º –º–µ—Ç—Ä–∏–∫ –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- `POST /api/agents/{agent_id}/restart` - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞
- `POST /api/agents/{agent_id}/stop` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞

### –°–∏—Å—Ç–µ–º–∞

- `GET /` - –ö–æ—Ä–Ω–µ–≤–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞
- `GET /docs` - Swagger UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –¢–∏–ø—ã –∫–æ–º–∞–Ω–¥

### 1. collect_metrics
–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Å –∞–≥–µ–Ω—Ç–∞
```json
{
    "command": "collect_metrics",
    "data": {
        "metrics": {"cpu": true, "memory": true},
        "immediate": true
    }
}
```

### 2. update_config
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞
```json
{
    "command": "update_config",
    "data": {
        "update_frequency": 300,
        "enabled_metrics": {"cpu": true, "gpu": false}
    }
}
```

### 3. restart
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞
```json
{
    "command": "restart",
    "data": {}
}
```

### 4. stop
–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞
```json
{
    "command": "stop",
    "data": {}
}
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –∫–æ–º–∞–Ω–¥

### ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã
- –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- –î–æ 3 –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ç–∞–π–º–∞—É—Ç—ã

### ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ö–æ–º–∞–Ω–¥—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç API
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- –§–æ–Ω–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ BackgroundTasks

### ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —ç–º–æ–¥–∑–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö

## –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### MetricsData
```python
class MetricsData(BaseModel):
    agent_id: str
    machine_name: str
    machine_type: str
    timestamp: datetime
    cpu_usage: float
    memory_usage: float
    disk_usage: float
    network_io: Dict[str, float]
```

### AgentConfig
```python
class AgentConfig(BaseModel):
    agent_id: str
    machine_name: str
    update_frequency: int = 60
    enabled_metrics: Dict[str, bool] = Field(default_factory=dict)
```

### AgentCommand
```python
class AgentCommand(BaseModel):
    command: str
    data: Dict[str, Any] = Field(default_factory=dict)
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `HOST` - –•–æ—Å—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0.0.0.0)
- `PORT` - –ü–æ—Ä—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 8000)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤
- `agent_timeout` - –¢–∞–π–º–∞—É—Ç –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ñ–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞ (300 —Å–µ–∫)
- `command_timeout` - –¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã (30 —Å–µ–∫)
- `max_concurrent_commands` - –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –Ω–∞ –∞–≥–µ–Ω—Ç–∞ (5)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏:
```bash
python run.py
```

### API –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤
curl http://localhost:8000/api/agents/statistics

# –°—Ç–∞—Ç—É—Å –∫–æ–º–∞–Ω–¥
curl http://localhost:8000/api/agents/command-executions/status

# –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–∞–Ω–¥ –∞–≥–µ–Ω—Ç–∞
curl http://localhost:8000/api/agents/agent_001/command-executions
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```bash
python test_unified_registration.py
```

### –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –∫–æ–º–∞–Ω–¥
```bash
python test_command_system.py
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1. **FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** - –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
2. **AgentService** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏ –∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
3. **API —Ä–æ—É—Ç–µ—Ä—ã** - REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
4. **Pydantic –º–æ–¥–µ–ª–∏** - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
- **Push –º–æ–¥–µ–ª—å** - –°–µ—Ä–≤–µ—Ä –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –∫–æ–º–∞–Ω–¥ –∞–≥–µ–Ω—Ç–∞–º
- **HTTP API** - –ê–≥–µ–Ω—Ç—ã —Å–ª—É—à–∞—é—Ç –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –ø–æ—Ä—Ç—É 8081
- **JSON —Ñ–æ—Ä–º–∞—Ç** - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ JSON

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **PostgreSQL –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∏ –∫–æ–º–∞–Ω–¥
2. **SNMP –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
3. **Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
4. **–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤
5. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - JWT —Ç–æ–∫–µ–Ω—ã –∏ HTTPS –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–°–∏—Å—Ç–µ–º–∞ –∫–æ–º–∞–Ω–¥](COMMAND_SYSTEM.md) - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–º–∞–Ω–¥
- [–ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏](unified_registration_style.md) - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤
- [CHANGELOG](CHANGELOG.md) - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π 