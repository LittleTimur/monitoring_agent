# API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç `/command`

## –û–±–∑–æ—Ä

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞–º–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ–¥–∏–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/command` —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏.

## –ë–∞–∑–æ–≤—ã–π URL

```
POST /api/agents/{agent_id}/command
POST /api/agents/command_all
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã

### 1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–±–∏—Ä–∞–µ–º—ã—Ö –º–µ—Ç—Ä–∏–∫ –∏ –≤—Ä–µ–º–µ–Ω–∏ —Å–±–æ—Ä–∞

**–ö–æ–º–∞–Ω–¥–∞:** `update_config`

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "command": "update_config",
  "data": {
    "enabled_metrics": {
      "cpu": true,
      "memory": false,
      "disk": false,
      "network": false,
      "gpu": false,
      "hdd": false,
      "inventory": false
    },
    "update_frequency": 39
  }
}
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- `enabled_metrics` - –æ–±—ä–µ–∫—Ç —Å —Ñ–ª–∞–≥–∞–º–∏ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
- `update_frequency` - –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

### 2. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–±–æ—Ä –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫

**–ö–æ–º–∞–Ω–¥–∞:** `collect_metrics`

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "command": "collect_metrics",
  "data": {
    "metrics": {
      "cpu": false,
      "memory": true,
      "disk": false,
      "network": false,
      "gpu": false,
      "hdd": false,
      "inventory": false
    },
    "immediate": true
  }
}
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- `metrics` - –æ–±—ä–µ–∫—Ç —Å —Ñ–ª–∞–≥–∞–º–∏ –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- `immediate` - —Ñ–ª–∞–≥ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å–±–æ—Ä–∞ (–≤—Å–µ–≥–¥–∞ true)

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞

**–ö–æ–º–∞–Ω–¥–∞:** `restart`

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "command": "restart",
  "data": {}
}
```

### 4. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞

**–ö–æ–º–∞–Ω–¥–∞:** `stop`

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "command": "stop",
  "data": {}
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∞–≥–µ–Ω—Ç—É

```bash
curl -X POST "http://localhost:8000/api/agents/agent_123/command" \
  -H "Content-Type: application/json" \
  -d '{
    "command": "update_config",
    "data": {
      "enabled_metrics": {
        "cpu": true,
        "memory": true,
        "disk": false
      },
      "update_frequency": 60
    }
  }'
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –≤—Å–µ–º –∞–≥–µ–Ω—Ç–∞–º

```bash
curl -X POST "http://localhost:8000/api/agents/command_all" \
  -H "Content-Type: application/json" \
  -d '{
    "command": "collect_metrics",
    "data": {
      "metrics": {
        "cpu": true,
        "memory": true
      }
    }
  }'
```

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–±–æ—Ä –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫

```bash
curl -X POST "http://localhost:8000/api/agents/agent_123/command" \
  -H "Content-Type: application/json" \
  -d '{
    "command": "collect_metrics",
    "data": {
      "metrics": {
        "cpu": true,
        "memory": true,
        "disk": true,
        "network": true,
        "gpu": false,
        "hdd": false,
        "inventory": true
      }
    }
  }'
```

## –û—Ç–≤–µ—Ç—ã

### –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```json
{
  "status": "success",
  "message": "Command 'update_config' sent to agent agent_123"
}
```

### –û—à–∏–±–∫–∞
```json
{
  "detail": "Agent not found"
}
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
- `üöÄ –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã '{command}' –∞–≥–µ–Ω—Ç—É {agent_id}`
- `‚úÖ –ö–æ–º–∞–Ω–¥–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–≥–µ–Ω—Ç—É {agent_id}`
- `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã: {message}`

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ê–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã `update_config`
2. **–ú–µ—Ç—Ä–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ** –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã `collect_metrics`
3. **–ö–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** —á–µ—Ä–µ–∑ background tasks
4. **–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å** –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
5. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
